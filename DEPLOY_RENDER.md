# رفع مشروع UniPilot على Render.com

دليل خطوة بخطوة لرفع **الواجهة (Frontend)** و**السيرفر + قاعدة البيانات (Backend)** على Render بشكل مجاني.

---

## ما الذي سنرفعه؟

| الجزء | النوع على Render | الوصف |
|------|------------------|--------|
| **Backend** | Web Service | سيرفر Node/Express + SQLite (ملف داخل السيرفر) |
| **Frontend** | Static Site | موقع ثابت (Vite React) يتصل بالـ Backend عبر عنوان الـ API |

**ملاحظة عن قاعدة البيانات:** على الخطة المجانية من Render، الملفات على السيرفر **مؤقتة** (تُمسح عند إعادة التشغيل أو إعادة النشر). أي بيانات في SQLite قد تُفقد. إذا أردت حفظ البيانات بشكل دائم، يمكن لاحقاً استخدام PostgreSQL المجاني على Render وتعديل الكود للاتصال بها.

---

## المتطلبات قبل البدء

1. حساب على [Render.com](https://render.com) (مجاني).
2. المشروع مرفوع على **GitHub** (أو GitLab).
3. أن يكون المشروع يبني ويشتغل محلياً (مجلد `frontend-vite`).

---

## الجزء 1: رفع السيرفر (Backend) على Render

### الخطوة 1: إنشاء Web Service جديد

1. ادخل إلى [dashboard.render.com](https://dashboard.render.com).
2. اضغط **New +** ثم اختر **Web Service**.
3. اختر **Connect a repository** وربط المستودع (Repo) الذي فيه المشروع.
4. إذا لم يكن المستودع مربوطاً، اضغط **Connect GitHub** واختر المستودع ثم أذن لـ Render بالوصول.

### الخطوة 2: إعدادات الخدمة (Backend)

استخدم الإعدادات التالية **بالضبط**:

| الحقل | القيمة |
|--------|--------|
| **Name** | `unipilot-api` (أو أي اسم تفضله) |
| **Region** | اختر الأقرب لك (مثلاً Frankfurt) |
| **Root Directory** | `frontend-vite` |
| **Runtime** | `Node` |
| **Build Command** | `npm install` |
| **Start Command** | `node server/index.js` |
| **Instance Type** | **Free** |

### الخطوة 3: متغيرات البيئة (اختياري)

في تبويب **Environment** يمكنك إضافة:

- `NODE_ENV` = `production`

لا تحتاج إلى `PORT`؛ Render يضيفه تلقائياً.

### الخطوة 4: النشر

1. اضغط **Create Web Service**.
2. انتظر حتى تنتهي عملية البناء والنشر (قد تستغرق بضع دقائق).
3. بعد النجاح، ستظهر رسالة خضراء وتظهر **عنوان الخدمة**، مثل:
   ```text
   https://unipilot-api.onrender.com
   ```
4. احفظ هذا الرابط؛ ستحتاجه للواجهة.
5. تأكد أن الـ API يعمل بفتح في المتصفح:
   ```text
   https://YOUR-SERVICE-NAME.onrender.com/api/health
   ```
   يجب أن ترى: `{"status":"ok"}`.

---

## الجزء 2: رفع الواجهة (Frontend) على Render

### الخطوة 1: إنشاء Static Site جديد

1. من الـ Dashboard اضغط **New +** ثم اختر **Static Site**.
2. اختر **نفس المستودع** المستخدم للـ Backend.

### الخطوة 2: إعدادات الواجهة

| الحقل | القيمة |
|--------|--------|
| **Name** | `unipilot` (أو أي اسم) |
| **Root Directory** | `frontend-vite` |
| **Build Command** | `npm run build` |
| **Publish Directory** | `dist` |

### الخطوة 3: متغير البيئة المهم (للاتصال بالـ API)

يجب أن تعرف الواجهة عنوان الـ API **أثناء البناء**:

1. في نفس الصفحة، افتح قسم **Environment** (Environment Variables).
2. اضغط **Add Environment Variable**.
3. أضف:
   - **Key:** `VITE_BACKEND_URL`
   - **Value:** عنوان الـ Backend الذي حفظته، **بدون** شريط في الآخر، مثل:
     ```text
     https://unipilot-api.onrender.com
     ```

**مهم:** لا تكتب `/api` في آخر الرابط؛ الكود يضيفها تلقائياً.

### الخطوة 4: النشر

1. اضغط **Create Static Site**.
2. انتظر انتهاء البناء والنشر.
3. بعد النجاح، Render يعطيك رابط الموقع، مثل:
   ```text
   https://unipilot.onrender.com
   ```

---

## الجزء 3: التأكد من أن كل شيء يعمل

1. افتح رابط الـ **Static Site** (الواجهة) في المتصفح.
2. سجّل دخول أو أنشئ حساباً.
3. إذا سجّلت الدخول وظهرت البيانات أو لوحة التحكم، فالواجهة تتصل بالـ API بنجاح.

إذا ظهرت رسالة مثل "لا يمكن الاتصال" أو بقيت الواجهة في وضع Demo، راجع:

- أن `VITE_BACKEND_URL` مضبوط بشكل صحيح (نفس رابط الـ Backend).
- أنك أعدت النشر (Redeploy) للـ Static Site **بعد** إضافة أو تعديل `VITE_BACKEND_URL`، لأن القيمة تُدمج في الواجهة وقت البناء فقط.

---

## ملخص الروابط

بعد النشر ستكون عندك تقريباً:

| الخدمة | الرابط النموذجي |
|--------|------------------|
| **الواجهة (الموقع)** | `https://unipilot.onrender.com` |
| **الـ API (السيرفر)** | `https://unipilot-api.onrender.com` |
| **التحقق من صحة الـ API** | `https://unipilot-api.onrender.com/api/health` |

---

## نصائح إضافية

- **النوم (Spin down):** على الخطة المجانية، السيرفر ينام بعد فترة عدم استخدام. أول طلب بعد الاستيقاظ قد يأخذ 30–60 ثانية، ثم يعود كل شيء طبيعي.
- **قاعدة البيانات:** كما ذكرنا، على الخطة المجانية بيانات SQLite قد تُفقد عند إعادة تشغيل أو إعادة نشر الـ Web Service. للاحتفاظ بالبيانات بشكل دائم يمكن لاحقاً إنشاء **PostgreSQL** مجاني على Render وتعديل المشروع لاستخدامها بدل SQLite.
- **تحديث الموقع:** عند دفع تغييرات جديدة إلى GitHub، Render يعيد النشر تلقائياً إذا كان **Auto-Deploy** مفعّلاً (وهو افتراضي).

إذا واجهت خطأ معيّن (مثل فشل البناء أو 404)، اذكر اسم الخدمة (Backend أو Frontend) ورسالة الخطأ لأتمكن من توجيهك خطوة إضافية.
