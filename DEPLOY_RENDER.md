# رفع مشروع UniPilot على Render.com (مرة واحدة)

دليل خطوة بخطوة لرفع المشروع **بالكامل** على Render كـ **خدمة واحدة**: الواجهة + السيرفر + قاعدة البيانات معاً، بدون رفع الباك إند والفرونت إند بشكل منفصل.

---

## ما الذي سنرفعه؟

| المكوّن | الوصف |
|---------|--------|
| **الواجهة (Frontend)** | موقع React مبني بـ Vite ويُخدم كملفات ثابتة من السيرفر |
| **السيرفر (Backend)** | Node/Express يقدّم الـ API وملفات الواجهة معاً |
| **قاعدة البيانات** | SQLite (ملف داخل السيرفر) |

كل هذا يعمل على **Web Service واحد** على Render. رابط واحد للموقع والـ API معاً.

**ملاحظة:** على الخطة المجانية، ملفات السيرفر مؤقتة؛ بيانات SQLite قد تُفقد عند إعادة النشر أو إعادة التشغيل. لاحقاً يمكن استخدام PostgreSQL المجاني لاستمرارية البيانات.

---

## المتطلبات قبل البدء

1. حساب على [Render.com](https://render.com) (مجاني).
2. المشروع مرفوع على **GitHub** (بدون مجلد `node_modules`).
3. أن يكون المشروع يبني ويشتغل محلياً.

---

## الخطوة 1: الدخول إلى Render وربط المستودع

1. ادخل إلى [https://dashboard.render.com](https://dashboard.render.com) وسجّل الدخول.
2. اضغط الزر **New +** (أعلى اليمين).
3. اختر **Web Service**.
4. في قسم **Connect a repository**:
   - إذا ظهر مستودعك (مثلاً `Nibrasdaboul/unipilot`)، اختره.
   - إذا لم يظهر، اضغط **Connect GitHub** (أو **Connect GitLab**) واختر الحساب ثم المستودع، واسمح لـ Render بالوصول إلى المستودع.
5. بعد اختيار المستودع، اضغط **Connect** أو **Next**.

---

## الخطوة 2: إعدادات الخدمة (مهم جداً)

في صفحة إنشاء الـ Web Service، املأ الحقول كما يلي **بالضبط**:

| الحقل | القيمة التي تدخلها |
|--------|----------------------|
| **Name** | `unipilot` (أو أي اسم تفضله؛ سيصبح جزءاً من الرابط) |
| **Region** | اختر منطقة قريبة منك (مثلاً **Frankfurt** أو **Oregon**) |
| **Root Directory** | اتركه **فارغاً** إذا رفعت محتويات `frontend-vite` كجذر المستودع. إذا المستودع فيه مجلد `frontend-vite`، اكتب: `frontend-vite` |
| **Runtime** | `Node` |
| **Build Command** | `npm install && npm run build` |
| **Start Command** | `node server/index.js` |
| **Instance Type** | **Free** |

### توضيح الحقول

- **Build Command:** يثبّت التبعيات ثم يبني الواجهة ويضع الناتج في مجلد `dist/`.
- **Start Command:** يشغّل سيرفر Express الذي يخدم الـ API وملفات الواجهة من `dist/` معاً.
- **Root Directory:** فقط إذا كان `package.json` و `server/` داخل مجلد (مثلاً `frontend-vite`) في المستودع؛ وإلا اتركه فارغاً.

---

## الخطوة 3: متغيرات البيئة (اختياري)

في نفس الصفحة، انزل إلى قسم **Environment Variables** (Environment).

- يمكنك إضافة: **Key:** `NODE_ENV` ، **Value:** `production`.
- **لا تحتاج** إلى `PORT` ولا إلى `VITE_BACKEND_URL`؛ Render يضيف `PORT` تلقائياً، والواجهة تستخدم نفس الرابط للـ API.

يمكنك ترك القسم فارغاً والمتابعة.

---

## الخطوة 4: إنشاء الخدمة والنشر

1. اضغط **Create Web Service** في أسفل الصفحة.
2. ستنتقل إلى صفحة الخدمة وتبدأ عملية **Build** ثم **Deploy** تلقائياً.
3. انتظر حتى تكتمل:
   - **Building:** تثبيت الحزم ثم تنفيذ `npm run build` (قد يستغرق 1–3 دقائق).
   - **Deploying:** تشغيل `node server/index.js` وربط المنفذ.
4. عند النجاح تظهر رسالة خضراء مثل **Live** أو **Deploy live**، ويظهر في أعلى الصفحة رابط الخدمة، مثل:
   ```text
   https://unipilot.onrender.com
   ```

هذا الرابط هو **موقعك بالكامل** (واجهة + API).

---

## الخطوة 5: التأكد أن كل شيء يعمل

1. **التحقق من الـ API:**  
   افتح في المتصفح:
   ```text
   https://YOUR-SERVICE-NAME.onrender.com/api/health
   ```
   يجب أن ترى: `{"status":"ok"}`.

2. **فتح الموقع:**  
   افتح الرابط الأساسي:
   ```text
   https://YOUR-SERVICE-NAME.onrender.com
   ```
   يجب أن تظهر واجهة UniPilot (صفحة تسجيل الدخول أو الصفحة الرئيسية).

3. **تجربة تسجيل الدخول:**  
   أنشئ حساباً أو سجّل دخولاً. إذا تم الدخول وظهرت لوحة التحكم أو البيانات، فالواجهة تتصل بالـ API بنجاح.

---

## ملخص بخطوة واحدة (للمراجعة)

| ماذا تفعل | القيمة |
|-----------|--------|
| نوع الخدمة | **Web Service** |
| Build Command | `npm install && npm run build` |
| Start Command | `node server/index.js` |
| Instance Type | **Free** |
| الرابط النهائي | `https://YOUR-SERVICE-NAME.onrender.com` |

---

## نصائح إضافية

- **النوم (Spin down):** على الخطة المجانية، الخدمة تنام بعد فترة عدم استخدام. أول طلب بعد الاستيقاظ قد يأخذ 30–60 ثانية، ثم يعود كل شيء طبيعي.
- **تحديث الموقع:** عند دفع تغييرات جديدة إلى GitHub، Render يعيد النشر تلقائياً إذا كان **Auto-Deploy** مفعّلاً (وهو افتراضي).
- **قاعدة البيانات:** بيانات SQLite قد تُفقد عند إعادة النشر أو إعادة التشغيل. لاستمرارية البيانات لاحقاً يمكن استخدام PostgreSQL المجاني على Render وتعديل المشروع للاتصال بها.

إذا واجهت خطأ (مثل فشل البناء أو "No open ports detected")، تأكد من أن **Start Command** هو بالضبط `node server/index.js` و**Build Command** هو `npm install && npm run build`.
